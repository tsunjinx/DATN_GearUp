{
  "database_name": "datn_gearup",
  "description": "Database schema for DATN_GearUp shoe store management system",
  "version": "1.0.0",
  "created_at": "2025-08-07",
  "tables": {
    "users": {
      "description": "Core user authentication table for all user types",
      "columns": {
        "id": {
          "type": "integer",
          "primary_key": true,
          "auto_increment": true,
          "nullable": false
        },
        "email": {
          "type": "varchar",
          "length": 255,
          "unique": true,
          "nullable": false
        },
        "username": {
          "type": "varchar",
          "length": 100,
          "unique": true,
          "nullable": false
        },
        "password_hash": {
          "type": "varchar",
          "length": 255,
          "nullable": false
        },
        "full_name": {
          "type": "varchar",
          "length": 255,
          "nullable": false
        },
        "phone": {
          "type": "varchar",
          "length": 20,
          "nullable": true
        },
        "user_type": {
          "type": "enum",
          "values": ["admin", "employee", "customer"],
          "default": "customer",
          "nullable": false
        },
        "is_active": {
          "type": "boolean",
          "default": true,
          "nullable": false
        },
        "created_at": {
          "type": "timestamp",
          "default": "CURRENT_TIMESTAMP",
          "nullable": false
        },
        "updated_at": {
          "type": "timestamp",
          "default": "CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP",
          "nullable": false
        },
        "last_login": {
          "type": "timestamp",
          "nullable": true
        }
      },
      "indexes": [
        {
          "name": "idx_users_email",
          "columns": ["email"],
          "unique": true
        },
        {
          "name": "idx_users_username",
          "columns": ["username"],
          "unique": true
        },
        {
          "name": "idx_users_type_active",
          "columns": ["user_type", "is_active"]
        }
      ]
    },
    "categories": {
      "description": "Product categories for organizing shoes",
      "columns": {
        "id": {
          "type": "integer",
          "primary_key": true,
          "auto_increment": true,
          "nullable": false
        },
        "name": {
          "type": "varchar",
          "length": 255,
          "unique": true,
          "nullable": false
        },
        "slug": {
          "type": "varchar",
          "length": 255,
          "unique": true,
          "nullable": false
        },
        "description": {
          "type": "text",
          "nullable": true
        },
        "image_url": {
          "type": "varchar",
          "length": 500,
          "nullable": true
        },
        "is_active": {
          "type": "boolean",
          "default": true,
          "nullable": false
        },
        "sort_order": {
          "type": "integer",
          "default": 0,
          "nullable": false
        },
        "created_at": {
          "type": "timestamp",
          "default": "CURRENT_TIMESTAMP",
          "nullable": false
        },
        "updated_at": {
          "type": "timestamp",
          "default": "CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP",
          "nullable": false
        }
      },
      "indexes": [
        {
          "name": "idx_categories_slug",
          "columns": ["slug"],
          "unique": true
        },
        {
          "name": "idx_categories_active_sort",
          "columns": ["is_active", "sort_order"]
        }
      ]
    },
    "brands": {
      "description": "Shoe brands (Nike, Adidas, Puma, etc.)",
      "columns": {
        "id": {
          "type": "integer",
          "primary_key": true,
          "auto_increment": true,
          "nullable": false
        },
        "name": {
          "type": "varchar",
          "length": 255,
          "unique": true,
          "nullable": false
        },
        "slug": {
          "type": "varchar",
          "length": 255,
          "unique": true,
          "nullable": false
        },
        "description": {
          "type": "text",
          "nullable": true
        },
        "logo_url": {
          "type": "varchar",
          "length": 500,
          "nullable": true
        },
        "website_url": {
          "type": "varchar",
          "length": 500,
          "nullable": true
        },
        "is_active": {
          "type": "boolean",
          "default": true,
          "nullable": false
        },
        "created_at": {
          "type": "timestamp",
          "default": "CURRENT_TIMESTAMP",
          "nullable": false
        },
        "updated_at": {
          "type": "timestamp",
          "default": "CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP",
          "nullable": false
        }
      },
      "indexes": [
        {
          "name": "idx_brands_slug",
          "columns": ["slug"],
          "unique": true
        },
        {
          "name": "idx_brands_active",
          "columns": ["is_active"]
        }
      ]
    },
    "products": {
      "description": "Main product catalog for shoes",
      "columns": {
        "id": {
          "type": "integer",
          "primary_key": true,
          "auto_increment": true,
          "nullable": false
        },
        "code": {
          "type": "varchar",
          "length": 100,
          "unique": true,
          "nullable": false,
          "comment": "Product SKU"
        },
        "name": {
          "type": "varchar",
          "length": 500,
          "nullable": false
        },
        "description": {
          "type": "text",
          "nullable": true
        },
        "category_id": {
          "type": "integer",
          "foreign_key": {
            "table": "categories",
            "column": "id",
            "on_delete": "RESTRICT",
            "on_update": "CASCADE"
          },
          "nullable": false
        },
        "brand_id": {
          "type": "integer",
          "foreign_key": {
            "table": "brands",
            "column": "id",
            "on_delete": "RESTRICT",
            "on_update": "CASCADE"
          },
          "nullable": false
        },
        "price": {
          "type": "decimal",
          "precision": 15,
          "scale": 2,
          "nullable": false,
          "comment": "Current selling price"
        },
        "original_price": {
          "type": "decimal",
          "precision": 15,
          "scale": 2,
          "nullable": true,
          "comment": "Original price before discount"
        },
        "stock_quantity": {
          "type": "integer",
          "default": 0,
          "nullable": false
        },
        "min_stock_level": {
          "type": "integer",
          "default": 10,
          "nullable": false,
          "comment": "Minimum stock alert level"
        },
        "status": {
          "type": "enum",
          "values": ["active", "inactive", "discontinued"],
          "default": "active",
          "nullable": false
        },
        "sizes": {
          "type": "json",
          "nullable": true,
          "comment": "Available sizes array"
        },
        "colors": {
          "type": "json",
          "nullable": true,
          "comment": "Available colors array"
        },
        "main_image_url": {
          "type": "varchar",
          "length": 500,
          "nullable": true
        },
        "additional_images": {
          "type": "json",
          "nullable": true,
          "comment": "Array of additional image URLs"
        },
        "weight": {
          "type": "decimal",
          "precision": 8,
          "scale": 3,
          "nullable": true,
          "comment": "Product weight in kg"
        },
        "specifications": {
          "type": "json",
          "nullable": true,
          "comment": "Technical specifications JSON"
        },
        "rating_average": {
          "type": "decimal",
          "precision": 3,
          "scale": 2,
          "default": 0.00,
          "nullable": false,
          "comment": "Average customer rating"
        },
        "review_count": {
          "type": "integer",
          "default": 0,
          "nullable": false,
          "comment": "Number of reviews"
        },
        "view_count": {
          "type": "integer",
          "default": 0,
          "nullable": false,
          "comment": "Product view counter"
        },
        "is_featured": {
          "type": "boolean",
          "default": false,
          "nullable": false
        },
        "created_at": {
          "type": "timestamp",
          "default": "CURRENT_TIMESTAMP",
          "nullable": false
        },
        "updated_at": {
          "type": "timestamp",
          "default": "CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP",
          "nullable": false
        }
      },
      "indexes": [
        {
          "name": "idx_products_code",
          "columns": ["code"],
          "unique": true
        },
        {
          "name": "idx_products_category_brand",
          "columns": ["category_id", "brand_id"]
        },
        {
          "name": "idx_products_status_active",
          "columns": ["status"]
        },
        {
          "name": "idx_products_featured",
          "columns": ["is_featured"]
        },
        {
          "name": "idx_products_rating",
          "columns": ["rating_average"]
        }
      ]
    },
    "product_variants": {
      "description": "Product variants for different sizes and colors",
      "columns": {
        "id": {
          "type": "integer",
          "primary_key": true,
          "auto_increment": true,
          "nullable": false
        },
        "product_id": {
          "type": "integer",
          "foreign_key": {
            "table": "products",
            "column": "id",
            "on_delete": "CASCADE",
            "on_update": "CASCADE"
          },
          "nullable": false
        },
        "size": {
          "type": "varchar",
          "length": 10,
          "nullable": false
        },
        "color": {
          "type": "varchar",
          "length": 50,
          "nullable": false
        },
        "sku": {
          "type": "varchar",
          "length": 100,
          "unique": true,
          "nullable": false,
          "comment": "Variant specific SKU"
        },
        "stock_quantity": {
          "type": "integer",
          "default": 0,
          "nullable": false
        },
        "price_adjustment": {
          "type": "decimal",
          "precision": 10,
          "scale": 2,
          "default": 0.00,
          "nullable": false,
          "comment": "Price difference from base product"
        },
        "is_active": {
          "type": "boolean",
          "default": true,
          "nullable": false
        },
        "created_at": {
          "type": "timestamp",
          "default": "CURRENT_TIMESTAMP",
          "nullable": false
        },
        "updated_at": {
          "type": "timestamp",
          "default": "CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP",
          "nullable": false
        }
      },
      "indexes": [
        {
          "name": "idx_product_variants_sku",
          "columns": ["sku"],
          "unique": true
        },
        {
          "name": "idx_product_variants_product",
          "columns": ["product_id"]
        },
        {
          "name": "idx_product_variants_size_color",
          "columns": ["product_id", "size", "color"],
          "unique": true
        }
      ]
    },
    "customers": {
      "description": "Customer profile information",
      "columns": {
        "id": {
          "type": "integer",
          "primary_key": true,
          "auto_increment": true,
          "nullable": false
        },
        "user_id": {
          "type": "integer",
          "foreign_key": {
            "table": "users",
            "column": "id",
            "on_delete": "CASCADE",
            "on_update": "CASCADE"
          },
          "unique": true,
          "nullable": false
        },
        "date_of_birth": {
          "type": "date",
          "nullable": true
        },
        "gender": {
          "type": "enum",
          "values": ["male", "female", "other"],
          "nullable": true
        },
        "address": {
          "type": "text",
          "nullable": true
        },
        "city": {
          "type": "varchar",
          "length": 100,
          "nullable": true
        },
        "district": {
          "type": "varchar",
          "length": 100,
          "nullable": true
        },
        "ward": {
          "type": "varchar",
          "length": 100,
          "nullable": true
        },
        "postal_code": {
          "type": "varchar",
          "length": 20,
          "nullable": true
        },
        "customer_tier": {
          "type": "enum",
          "values": ["bronze", "silver", "gold", "platinum"],
          "default": "bronze",
          "nullable": false
        },
        "total_spent": {
          "type": "decimal",
          "precision": 15,
          "scale": 2,
          "default": 0.00,
          "nullable": false,
          "comment": "Total amount spent"
        },
        "total_orders": {
          "type": "integer",
          "default": 0,
          "nullable": false,
          "comment": "Number of orders placed"
        },
        "last_order_date": {
          "type": "timestamp",
          "nullable": true
        },
        "preferences": {
          "type": "json",
          "nullable": true,
          "comment": "Customer preferences JSON"
        },
        "receives_marketing_emails": {
          "type": "boolean",
          "default": true,
          "nullable": false
        },
        "created_at": {
          "type": "timestamp",
          "default": "CURRENT_TIMESTAMP",
          "nullable": false
        },
        "updated_at": {
          "type": "timestamp",
          "default": "CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP",
          "nullable": false
        }
      },
      "indexes": [
        {
          "name": "idx_customers_user",
          "columns": ["user_id"],
          "unique": true
        },
        {
          "name": "idx_customers_tier",
          "columns": ["customer_tier"]
        },
        {
          "name": "idx_customers_city",
          "columns": ["city"]
        }
      ]
    },
    "employees": {
      "description": "Employee profile and management information",
      "columns": {
        "id": {
          "type": "integer",
          "primary_key": true,
          "auto_increment": true,
          "nullable": false
        },
        "user_id": {
          "type": "integer",
          "foreign_key": {
            "table": "users",
            "column": "id",
            "on_delete": "CASCADE",
            "on_update": "CASCADE"
          },
          "unique": true,
          "nullable": false
        },
        "employee_code": {
          "type": "varchar",
          "length": 50,
          "unique": true,
          "nullable": false
        },
        "role": {
          "type": "enum",
          "values": ["admin", "manager", "staff", "cashier"],
          "default": "staff",
          "nullable": false
        },
        "salary": {
          "type": "decimal",
          "precision": 15,
          "scale": 2,
          "nullable": false
        },
        "start_date": {
          "type": "date",
          "nullable": false
        },
        "end_date": {
          "type": "date",
          "nullable": true,
          "comment": "null if still employed"
        },
        "employment_status": {
          "type": "enum",
          "values": ["active", "inactive", "terminated", "suspended"],
          "default": "active",
          "nullable": false
        },
        "department": {
          "type": "varchar",
          "length": 100,
          "nullable": true
        },
        "position": {
          "type": "varchar",
          "length": 100,
          "nullable": true
        },
        "manager_id": {
          "type": "integer",
          "foreign_key": {
            "table": "employees",
            "column": "id",
            "on_delete": "SET NULL",
            "on_update": "CASCADE"
          },
          "nullable": true,
          "comment": "Self-reference to EMPLOYEES"
        },
        "permissions": {
          "type": "json",
          "nullable": true,
          "comment": "Role permissions JSON"
        },
        "created_at": {
          "type": "timestamp",
          "default": "CURRENT_TIMESTAMP",
          "nullable": false
        },
        "updated_at": {
          "type": "timestamp",
          "default": "CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP",
          "nullable": false
        }
      },
      "indexes": [
        {
          "name": "idx_employees_user",
          "columns": ["user_id"],
          "unique": true
        },
        {
          "name": "idx_employees_code",
          "columns": ["employee_code"],
          "unique": true
        },
        {
          "name": "idx_employees_role_status",
          "columns": ["role", "employment_status"]
        },
        {
          "name": "idx_employees_manager",
          "columns": ["manager_id"]
        }
      ]
    },
    "orders": {
      "description": "Customer orders and order management",
      "columns": {
        "id": {
          "type": "integer",
          "primary_key": true,
          "auto_increment": true,
          "nullable": false
        },
        "order_number": {
          "type": "varchar",
          "length": 50,
          "unique": true,
          "nullable": false,
          "comment": "Generated order number"
        },
        "customer_id": {
          "type": "integer",
          "foreign_key": {
            "table": "customers",
            "column": "id",
            "on_delete": "RESTRICT",
            "on_update": "CASCADE"
          },
          "nullable": false
        },
        "employee_id": {
          "type": "integer",
          "foreign_key": {
            "table": "employees",
            "column": "id",
            "on_delete": "SET NULL",
            "on_update": "CASCADE"
          },
          "nullable": true,
          "comment": "Employee who processed the order"
        },
        "subtotal": {
          "type": "decimal",
          "precision": 15,
          "scale": 2,
          "nullable": false,
          "comment": "Sum of all items before discounts"
        },
        "discount_amount": {
          "type": "decimal",
          "precision": 15,
          "scale": 2,
          "default": 0.00,
          "nullable": false,
          "comment": "Total discount applied"
        },
        "tax_amount": {
          "type": "decimal",
          "precision": 15,
          "scale": 2,
          "default": 0.00,
          "nullable": false,
          "comment": "Tax amount"
        },
        "shipping_fee": {
          "type": "decimal",
          "precision": 15,
          "scale": 2,
          "default": 0.00,
          "nullable": false
        },
        "total_amount": {
          "type": "decimal",
          "precision": 15,
          "scale": 2,
          "nullable": false,
          "comment": "Final amount to pay"
        },
        "status": {
          "type": "enum",
          "values": ["pending", "confirmed", "processing", "shipping", "delivered", "completed", "cancelled", "returned"],
          "default": "pending",
          "nullable": false
        },
        "payment_status": {
          "type": "enum",
          "values": ["pending", "paid", "partial", "refunded", "failed"],
          "default": "pending",
          "nullable": false
        },
        "payment_method": {
          "type": "enum",
          "values": ["cash", "card", "bank_transfer", "e_wallet"],
          "nullable": true
        },
        "payment_reference": {
          "type": "varchar",
          "length": 255,
          "nullable": true,
          "comment": "Payment transaction reference"
        },
        "shipping_address": {
          "type": "text",
          "nullable": true
        },
        "customer_phone": {
          "type": "varchar",
          "length": 20,
          "nullable": true
        },
        "customer_email": {
          "type": "varchar",
          "length": 255,
          "nullable": true
        },
        "notes": {
          "type": "text",
          "nullable": true,
          "comment": "Order notes"
        },
        "order_date": {
          "type": "timestamp",
          "default": "CURRENT_TIMESTAMP",
          "nullable": false
        },
        "confirmed_at": {
          "type": "timestamp",
          "nullable": true
        },
        "shipped_at": {
          "type": "timestamp",
          "nullable": true
        },
        "delivered_at": {
          "type": "timestamp",
          "nullable": true
        },
        "created_at": {
          "type": "timestamp",
          "default": "CURRENT_TIMESTAMP",
          "nullable": false
        },
        "updated_at": {
          "type": "timestamp",
          "default": "CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP",
          "nullable": false
        }
      },
      "indexes": [
        {
          "name": "idx_orders_number",
          "columns": ["order_number"],
          "unique": true
        },
        {
          "name": "idx_orders_customer_status",
          "columns": ["customer_id", "status"]
        },
        {
          "name": "idx_orders_date",
          "columns": ["order_date"]
        },
        {
          "name": "idx_orders_status",
          "columns": ["status"]
        },
        {
          "name": "idx_orders_payment_status",
          "columns": ["payment_status"]
        }
      ]
    },
    "order_items": {
      "description": "Individual items within orders",
      "columns": {
        "id": {
          "type": "integer",
          "primary_key": true,
          "auto_increment": true,
          "nullable": false
        },
        "order_id": {
          "type": "integer",
          "foreign_key": {
            "table": "orders",
            "column": "id",
            "on_delete": "CASCADE",
            "on_update": "CASCADE"
          },
          "nullable": false
        },
        "product_id": {
          "type": "integer",
          "foreign_key": {
            "table": "products",
            "column": "id",
            "on_delete": "RESTRICT",
            "on_update": "CASCADE"
          },
          "nullable": false
        },
        "product_variant_id": {
          "type": "integer",
          "foreign_key": {
            "table": "product_variants",
            "column": "id",
            "on_delete": "SET NULL",
            "on_update": "CASCADE"
          },
          "nullable": true,
          "comment": "null if no specific variant"
        },
        "product_name": {
          "type": "varchar",
          "length": 500,
          "nullable": false,
          "comment": "Snapshot of product name at order time"
        },
        "product_sku": {
          "type": "varchar",
          "length": 100,
          "nullable": false,
          "comment": "Snapshot of SKU at order time"
        },
        "quantity": {
          "type": "integer",
          "nullable": false
        },
        "unit_price": {
          "type": "decimal",
          "precision": 15,
          "scale": 2,
          "nullable": false,
          "comment": "Price per unit at order time"
        },
        "discount_amount": {
          "type": "decimal",
          "precision": 15,
          "scale": 2,
          "default": 0.00,
          "nullable": false,
          "comment": "Discount applied to this item"
        },
        "total_price": {
          "type": "decimal",
          "precision": 15,
          "scale": 2,
          "nullable": false,
          "comment": "quantity * unit_price - discount_amount"
        },
        "product_snapshot": {
          "type": "json",
          "nullable": true,
          "comment": "Snapshot of product details at order time"
        },
        "created_at": {
          "type": "timestamp",
          "default": "CURRENT_TIMESTAMP",
          "nullable": false
        },
        "updated_at": {
          "type": "timestamp",
          "default": "CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP",
          "nullable": false
        }
      },
      "indexes": [
        {
          "name": "idx_order_items_order",
          "columns": ["order_id"]
        },
        {
          "name": "idx_order_items_product",
          "columns": ["product_id"]
        },
        {
          "name": "idx_order_items_order_product",
          "columns": ["order_id", "product_id"]
        }
      ]
    },
    "discounts": {
      "description": "Discount campaigns and promotions",
      "columns": {
        "id": {
          "type": "integer",
          "primary_key": true,
          "auto_increment": true,
          "nullable": false
        },
        "name": {
          "type": "varchar",
          "length": 255,
          "nullable": false
        },
        "description": {
          "type": "text",
          "nullable": true
        },
        "type": {
          "type": "enum",
          "values": ["percentage", "fixed_amount"],
          "nullable": false
        },
        "value": {
          "type": "decimal",
          "precision": 15,
          "scale": 2,
          "nullable": false,
          "comment": "Discount value (percentage or fixed amount)"
        },
        "applicable_type": {
          "type": "enum",
          "values": ["all", "category", "product", "brand"],
          "default": "all",
          "nullable": false
        },
        "applicable_ids": {
          "type": "json",
          "nullable": true,
          "comment": "IDs of categories/products/brands if applicable"
        },
        "min_order_value": {
          "type": "decimal",
          "precision": 15,
          "scale": 2,
          "nullable": true,
          "comment": "Minimum order value to apply discount"
        },
        "max_discount_amount": {
          "type": "decimal",
          "precision": 15,
          "scale": 2,
          "nullable": true,
          "comment": "Maximum discount amount for percentage type"
        },
        "start_date": {
          "type": "timestamp",
          "nullable": false
        },
        "end_date": {
          "type": "timestamp",
          "nullable": false
        },
        "usage_limit": {
          "type": "integer",
          "nullable": true,
          "comment": "null for unlimited"
        },
        "usage_count": {
          "type": "integer",
          "default": 0,
          "nullable": false,
          "comment": "Current usage count"
        },
        "is_active": {
          "type": "boolean",
          "default": true,
          "nullable": false
        },
        "created_by": {
          "type": "integer",
          "foreign_key": {
            "table": "employees",
            "column": "id",
            "on_delete": "SET NULL",
            "on_update": "CASCADE"
          },
          "nullable": true,
          "comment": "Employee who created the discount"
        },
        "created_at": {
          "type": "timestamp",
          "default": "CURRENT_TIMESTAMP",
          "nullable": false
        },
        "updated_at": {
          "type": "timestamp",
          "default": "CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP",
          "nullable": false
        }
      },
      "indexes": [
        {
          "name": "idx_discounts_active_dates",
          "columns": ["is_active", "start_date", "end_date"]
        },
        {
          "name": "idx_discounts_type",
          "columns": ["applicable_type"]
        },
        {
          "name": "idx_discounts_created_by",
          "columns": ["created_by"]
        }
      ]
    },
    "coupons": {
      "description": "Individual coupon codes for customers",
      "columns": {
        "id": {
          "type": "integer",
          "primary_key": true,
          "auto_increment": true,
          "nullable": false
        },
        "code": {
          "type": "varchar",
          "length": 50,
          "unique": true,
          "nullable": false,
          "comment": "Coupon code"
        },
        "name": {
          "type": "varchar",
          "length": 255,
          "nullable": false
        },
        "description": {
          "type": "text",
          "nullable": true
        },
        "type": {
          "type": "enum",
          "values": ["percentage", "fixed_amount", "free_shipping"],
          "nullable": false
        },
        "value": {
          "type": "decimal",
          "precision": 15,
          "scale": 2,
          "nullable": false,
          "comment": "Coupon value"
        },
        "min_order_value": {
          "type": "decimal",
          "precision": 15,
          "scale": 2,
          "nullable": true,
          "comment": "Minimum order value to use coupon"
        },
        "max_discount_amount": {
          "type": "decimal",
          "precision": 15,
          "scale": 2,
          "nullable": true,
          "comment": "Maximum discount for percentage coupons"
        },
        "max_uses": {
          "type": "integer",
          "nullable": true,
          "comment": "Maximum number of uses, null for unlimited"
        },
        "used_count": {
          "type": "integer",
          "default": 0,
          "nullable": false,
          "comment": "Current usage count"
        },
        "max_uses_per_customer": {
          "type": "integer",
          "default": 1,
          "nullable": false,
          "comment": "Maximum uses per customer"
        },
        "expiry_date": {
          "type": "timestamp",
          "nullable": false
        },
        "is_active": {
          "type": "boolean",
          "default": true,
          "nullable": false
        },
        "applicable_products": {
          "type": "json",
          "nullable": true,
          "comment": "Array of applicable product IDs, null for all"
        },
        "applicable_categories": {
          "type": "json",
          "nullable": true,
          "comment": "Array of applicable category IDs, null for all"
        },
        "created_by": {
          "type": "integer",
          "foreign_key": {
            "table": "employees",
            "column": "id",
            "on_delete": "SET NULL",
            "on_update": "CASCADE"
          },
          "nullable": true,
          "comment": "Employee who created the coupon"
        },
        "created_at": {
          "type": "timestamp",
          "default": "CURRENT_TIMESTAMP",
          "nullable": false
        },
        "updated_at": {
          "type": "timestamp",
          "default": "CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP",
          "nullable": false
        }
      },
      "indexes": [
        {
          "name": "idx_coupons_code",
          "columns": ["code"],
          "unique": true
        },
        {
          "name": "idx_coupons_code_active",
          "columns": ["code", "is_active"]
        },
        {
          "name": "idx_coupons_expiry_active",
          "columns": ["expiry_date", "is_active"]
        },
        {
          "name": "idx_coupons_created_by",
          "columns": ["created_by"]
        }
      ]
    },
    "coupon_usage": {
      "description": "Tracking coupon usage by customers",
      "columns": {
        "id": {
          "type": "integer",
          "primary_key": true,
          "auto_increment": true,
          "nullable": false
        },
        "coupon_id": {
          "type": "integer",
          "foreign_key": {
            "table": "coupons",
            "column": "id",
            "on_delete": "CASCADE",
            "on_update": "CASCADE"
          },
          "nullable": false
        },
        "order_id": {
          "type": "integer",
          "foreign_key": {
            "table": "orders",
            "column": "id",
            "on_delete": "CASCADE",
            "on_update": "CASCADE"
          },
          "nullable": false
        },
        "customer_id": {
          "type": "integer",
          "foreign_key": {
            "table": "customers",
            "column": "id",
            "on_delete": "CASCADE",
            "on_update": "CASCADE"
          },
          "nullable": false
        },
        "discount_amount": {
          "type": "decimal",
          "precision": 15,
          "scale": 2,
          "nullable": false,
          "comment": "Actual discount amount applied"
        },
        "used_at": {
          "type": "timestamp",
          "default": "CURRENT_TIMESTAMP",
          "nullable": false
        }
      },
      "indexes": [
        {
          "name": "idx_coupon_usage_coupon",
          "columns": ["coupon_id"]
        },
        {
          "name": "idx_coupon_usage_customer",
          "columns": ["customer_id"]
        },
        {
          "name": "idx_coupon_usage_order",
          "columns": ["order_id"]
        },
        {
          "name": "idx_coupon_usage_coupon_customer",
          "columns": ["coupon_id", "customer_id"]
        }
      ]
    },
    "inventory_transactions": {
      "description": "Inventory movement tracking",
      "columns": {
        "id": {
          "type": "integer",
          "primary_key": true,
          "auto_increment": true,
          "nullable": false
        },
        "product_id": {
          "type": "integer",
          "foreign_key": {
            "table": "products",
            "column": "id",
            "on_delete": "CASCADE",
            "on_update": "CASCADE"
          },
          "nullable": false
        },
        "product_variant_id": {
          "type": "integer",
          "foreign_key": {
            "table": "product_variants",
            "column": "id",
            "on_delete": "CASCADE",
            "on_update": "CASCADE"
          },
          "nullable": true,
          "comment": "null if for main product"
        },
        "transaction_type": {
          "type": "enum",
          "values": ["in", "out", "adjustment", "return", "damage"],
          "nullable": false
        },
        "quantity": {
          "type": "integer",
          "nullable": false,
          "comment": "Positive for in, negative for out"
        },
        "unit_cost": {
          "type": "decimal",
          "precision": 15,
          "scale": 2,
          "nullable": true,
          "comment": "Cost per unit for incoming inventory"
        },
        "reference_number": {
          "type": "varchar",
          "length": 100,
          "nullable": true,
          "comment": "PO number, order number, etc."
        },
        "notes": {
          "type": "text",
          "nullable": true,
          "comment": "Transaction notes"
        },
        "created_by": {
          "type": "integer",
          "foreign_key": {
            "table": "employees",
            "column": "id",
            "on_delete": "SET NULL",
            "on_update": "CASCADE"
          },
          "nullable": true,
          "comment": "Employee who made the transaction"
        },
        "transaction_date": {
          "type": "timestamp",
          "default": "CURRENT_TIMESTAMP",
          "nullable": false
        },
        "created_at": {
          "type": "timestamp",
          "default": "CURRENT_TIMESTAMP",
          "nullable": false
        }
      },
      "indexes": [
        {
          "name": "idx_inventory_product_date",
          "columns": ["product_id", "transaction_date"]
        },
        {
          "name": "idx_inventory_variant_date",
          "columns": ["product_variant_id", "transaction_date"]
        },
        {
          "name": "idx_inventory_type",
          "columns": ["transaction_type"]
        },
        {
          "name": "idx_inventory_created_by",
          "columns": ["created_by"]
        },
        {
          "name": "idx_inventory_reference",
          "columns": ["reference_number"]
        }
      ]
    },
    "stock_alerts": {
      "description": "Stock level alerts and notifications",
      "columns": {
        "id": {
          "type": "integer",
          "primary_key": true,
          "auto_increment": true,
          "nullable": false
        },
        "product_id": {
          "type": "integer",
          "foreign_key": {
            "table": "products",
            "column": "id",
            "on_delete": "CASCADE",
            "on_update": "CASCADE"
          },
          "nullable": false
        },
        "product_variant_id": {
          "type": "integer",
          "foreign_key": {
            "table": "product_variants",
            "column": "id",
            "on_delete": "CASCADE",
            "on_update": "CASCADE"
          },
          "nullable": true,
          "comment": "null if for main product"
        },
        "alert_type": {
          "type": "enum",
          "values": ["low_stock", "out_of_stock", "overstock"],
          "nullable": false
        },
        "current_stock": {
          "type": "integer",
          "nullable": false
        },
        "threshold_value": {
          "type": "integer",
          "nullable": false
        },
        "is_resolved": {
          "type": "boolean",
          "default": false,
          "nullable": false
        },
        "alert_date": {
          "type": "timestamp",
          "default": "CURRENT_TIMESTAMP",
          "nullable": false
        },
        "resolved_at": {
          "type": "timestamp",
          "nullable": true
        },
        "resolved_by": {
          "type": "integer",
          "foreign_key": {
            "table": "employees",
            "column": "id",
            "on_delete": "SET NULL",
            "on_update": "CASCADE"
          },
          "nullable": true,
          "comment": "Employee who resolved the alert"
        }
      },
      "indexes": [
        {
          "name": "idx_stock_alerts_product",
          "columns": ["product_id"]
        },
        {
          "name": "idx_stock_alerts_variant",
          "columns": ["product_variant_id"]
        },
        {
          "name": "idx_stock_alerts_resolved",
          "columns": ["is_resolved"]
        },
        {
          "name": "idx_stock_alerts_type",
          "columns": ["alert_type"]
        }
      ]
    },
    "product_reviews": {
      "description": "Customer product reviews and ratings",
      "columns": {
        "id": {
          "type": "integer",
          "primary_key": true,
          "auto_increment": true,
          "nullable": false
        },
        "product_id": {
          "type": "integer",
          "foreign_key": {
            "table": "products",
            "column": "id",
            "on_delete": "CASCADE",
            "on_update": "CASCADE"
          },
          "nullable": false
        },
        "customer_id": {
          "type": "integer",
          "foreign_key": {
            "table": "customers",
            "column": "id",
            "on_delete": "CASCADE",
            "on_update": "CASCADE"
          },
          "nullable": false
        },
        "order_id": {
          "type": "integer",
          "foreign_key": {
            "table": "orders",
            "column": "id",
            "on_delete": "SET NULL",
            "on_update": "CASCADE"
          },
          "nullable": true,
          "comment": "Order in which product was purchased"
        },
        "rating": {
          "type": "integer",
          "nullable": false,
          "comment": "1-5 stars",
          "check": "rating >= 1 AND rating <= 5"
        },
        "title": {
          "type": "varchar",
          "length": 255,
          "nullable": true
        },
        "review_text": {
          "type": "text",
          "nullable": true
        },
        "images": {
          "type": "json",
          "nullable": true,
          "comment": "Array of review image URLs"
        },
        "is_verified_purchase": {
          "type": "boolean",
          "default": false,
          "nullable": false
        },
        "is_approved": {
          "type": "boolean",
          "default": false,
          "nullable": false
        },
        "helpful_count": {
          "type": "integer",
          "default": 0,
          "nullable": false,
          "comment": "Number of helpful votes"
        },
        "reviewed_at": {
          "type": "timestamp",
          "default": "CURRENT_TIMESTAMP",
          "nullable": false
        },
        "approved_at": {
          "type": "timestamp",
          "nullable": true
        },
        "approved_by": {
          "type": "integer",
          "foreign_key": {
            "table": "employees",
            "column": "id",
            "on_delete": "SET NULL",
            "on_update": "CASCADE"
          },
          "nullable": true,
          "comment": "Employee who approved the review"
        },
        "created_at": {
          "type": "timestamp",
          "default": "CURRENT_TIMESTAMP",
          "nullable": false
        },
        "updated_at": {
          "type": "timestamp",
          "default": "CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP",
          "nullable": false
        }
      },
      "indexes": [
        {
          "name": "idx_product_reviews_product",
          "columns": ["product_id"]
        },
        {
          "name": "idx_product_reviews_customer",
          "columns": ["customer_id"]
        },
        {
          "name": "idx_product_reviews_approved",
          "columns": ["is_approved"]
        },
        {
          "name": "idx_product_reviews_rating",
          "columns": ["rating"]
        },
        {
          "name": "idx_product_reviews_product_customer",
          "columns": ["product_id", "customer_id"],
          "unique": true
        }
      ]
    },
    "activity_logs": {
      "description": "System activity and audit trail",
      "columns": {
        "id": {
          "type": "integer",
          "primary_key": true,
          "auto_increment": true,
          "nullable": false
        },
        "user_id": {
          "type": "integer",
          "foreign_key": {
            "table": "users",
            "column": "id",
            "on_delete": "SET NULL",
            "on_update": "CASCADE"
          },
          "nullable": true,
          "comment": "User who performed the action"
        },
        "action_type": {
          "type": "varchar",
          "length": 50,
          "nullable": false,
          "comment": "create,update,delete,login,logout,etc."
        },
        "entity_type": {
          "type": "varchar",
          "length": 50,
          "nullable": true,
          "comment": "product,order,customer,etc."
        },
        "entity_id": {
          "type": "integer",
          "nullable": true,
          "comment": "ID of the affected entity"
        },
        "old_values": {
          "type": "json",
          "nullable": true,
          "comment": "Previous values before change"
        },
        "new_values": {
          "type": "json",
          "nullable": true,
          "comment": "New values after change"
        },
        "ip_address": {
          "type": "varchar",
          "length": 45,
          "nullable": true
        },
        "user_agent": {
          "type": "text",
          "nullable": true
        },
        "created_at": {
          "type": "timestamp",
          "default": "CURRENT_TIMESTAMP",
          "nullable": false
        }
      },
      "indexes": [
        {
          "name": "idx_activity_logs_user",
          "columns": ["user_id"]
        },
        {
          "name": "idx_activity_logs_action",
          "columns": ["action_type"]
        },
        {
          "name": "idx_activity_logs_entity",
          "columns": ["entity_type", "entity_id"]
        },
        {
          "name": "idx_activity_logs_date",
          "columns": ["created_at"]
        }
      ]
    }
  },
  "relationships": [
    {
      "from_table": "users",
      "from_column": "id",
      "to_table": "employees",
      "to_column": "user_id",
      "relationship_type": "one_to_one",
      "description": "User can have employee profile"
    },
    {
      "from_table": "users",
      "from_column": "id",
      "to_table": "customers",
      "to_column": "user_id",
      "relationship_type": "one_to_one",
      "description": "User can have customer profile"
    },
    {
      "from_table": "categories",
      "from_column": "id",
      "to_table": "products",
      "to_column": "category_id",
      "relationship_type": "one_to_many",
      "description": "Category contains many products"
    },
    {
      "from_table": "brands",
      "from_column": "id",
      "to_table": "products",
      "to_column": "brand_id",
      "relationship_type": "one_to_many",
      "description": "Brand has many products"
    },
    {
      "from_table": "products",
      "from_column": "id",
      "to_table": "product_variants",
      "to_column": "product_id",
      "relationship_type": "one_to_many",
      "description": "Product can have multiple variants"
    },
    {
      "from_table": "customers",
      "from_column": "id",
      "to_table": "orders",
      "to_column": "customer_id",
      "relationship_type": "one_to_many",
      "description": "Customer can place many orders"
    },
    {
      "from_table": "employees",
      "from_column": "id",
      "to_table": "orders",
      "to_column": "employee_id",
      "relationship_type": "one_to_many",
      "description": "Employee can process many orders"
    },
    {
      "from_table": "orders",
      "from_column": "id",
      "to_table": "order_items",
      "to_column": "order_id",
      "relationship_type": "one_to_many",
      "description": "Order contains many items"
    },
    {
      "from_table": "products",
      "from_column": "id",
      "to_table": "order_items",
      "to_column": "product_id",
      "relationship_type": "one_to_many",
      "description": "Product can be in many order items"
    },
    {
      "from_table": "coupons",
      "from_column": "id",
      "to_table": "coupon_usage",
      "to_column": "coupon_id",
      "relationship_type": "one_to_many",
      "description": "Coupon can be used multiple times"
    },
    {
      "from_table": "customers",
      "from_column": "id",
      "to_table": "coupon_usage",
      "to_column": "customer_id",
      "relationship_type": "one_to_many",
      "description": "Customer can use multiple coupons"
    },
    {
      "from_table": "products",
      "from_column": "id",
      "to_table": "product_reviews",
      "to_column": "product_id",
      "relationship_type": "one_to_many",
      "description": "Product can have multiple reviews"
    },
    {
      "from_table": "customers",
      "from_column": "id",
      "to_table": "product_reviews",
      "to_column": "customer_id",
      "relationship_type": "one_to_many",
      "description": "Customer can write multiple reviews"
    },
    {
      "from_table": "employees",
      "from_column": "id",
      "to_table": "employees",
      "to_column": "manager_id",
      "relationship_type": "one_to_many",
      "description": "Employee can manage other employees (self-reference)"
    }
  ],
  "views": [
    {
      "name": "active_products_view",
      "description": "View of all active products with category and brand names",
      "sql": "SELECT p.*, c.name as category_name, b.name as brand_name FROM products p JOIN categories c ON p.category_id = c.id JOIN brands b ON p.brand_id = b.id WHERE p.status = 'active' AND c.is_active = 1 AND b.is_active = 1"
    },
    {
      "name": "order_summary_view",
      "description": "Summary view of orders with customer information",
      "sql": "SELECT o.*, u.full_name as customer_name, u.email as customer_email, u.phone as customer_phone FROM orders o JOIN customers c ON o.customer_id = c.id JOIN users u ON c.user_id = u.id"
    },
    {
      "name": "low_stock_products_view",
      "description": "View of products with low stock levels",
      "sql": "SELECT p.*, c.name as category_name, b.name as brand_name FROM products p JOIN categories c ON p.category_id = c.id JOIN brands b ON p.brand_id = b.id WHERE p.stock_quantity <= p.min_stock_level AND p.status = 'active'"
    }
  ],
  "triggers": [
    {
      "name": "update_product_rating_trigger",
      "table": "product_reviews",
      "event": "AFTER INSERT",
      "description": "Updates product rating average when new review is added",
      "sql": "UPDATE products SET rating_average = (SELECT AVG(rating) FROM product_reviews WHERE product_id = NEW.product_id AND is_approved = 1), review_count = (SELECT COUNT(*) FROM product_reviews WHERE product_id = NEW.product_id AND is_approved = 1) WHERE id = NEW.product_id"
    },
    {
      "name": "update_customer_totals_trigger",
      "table": "orders",
      "event": "AFTER UPDATE",
      "description": "Updates customer total spent and order count when order is completed",
      "sql": "UPDATE customers SET total_spent = total_spent + NEW.total_amount, total_orders = total_orders + 1, last_order_date = NEW.updated_at WHERE id = NEW.customer_id AND NEW.status = 'completed' AND OLD.status != 'completed'"
    },
    {
      "name": "inventory_update_trigger",
      "table": "order_items",
      "event": "AFTER INSERT",
      "description": "Updates product stock quantity when order item is added",
      "sql": "UPDATE products SET stock_quantity = stock_quantity - NEW.quantity WHERE id = NEW.product_id"
    }
  ],
  "stored_procedures": [
    {
      "name": "sp_generate_order_number",
      "description": "Generates unique order number",
      "parameters": [],
      "returns": "VARCHAR(50)",
      "sql": "SELECT CONCAT('ORD-', DATE_FORMAT(NOW(), '%Y%m%d'), '-', LPAD(COALESCE(MAX(CAST(SUBSTRING(order_number, -4) AS UNSIGNED)), 0) + 1, 4, '0')) FROM orders WHERE DATE(created_at) = CURDATE()"
    },
    {
      "name": "sp_apply_discount",
      "description": "Calculates discount amount for order",
      "parameters": [
        {
          "name": "order_total",
          "type": "DECIMAL(15,2)"
        },
        {
          "name": "discount_id",
          "type": "INT"
        }
      ],
      "returns": "DECIMAL(15,2)",
      "sql": "-- Logic to calculate discount based on discount rules"
    }
  ],
  "data_seeding": {
    "categories": [
      {
        "name": "Giày thể thao",
        "slug": "giay-the-thao",
        "description": "Giày dành cho hoạt động thể thao và vận động"
      },
      {
        "name": "Giày boot",
        "slug": "giay-boot",
        "description": "Giày boot cao cổ thời trang"
      },
      {
        "name": "Dép sandal",
        "slug": "dep-sandal",
        "description": "Dép sandal thoáng mát cho mùa hè"
      },
      {
        "name": "Giày tây",
        "slug": "giay-tay",
        "description": "Giày tây lịch sự cho công sở"
      }
    ],
    "brands": [
      {
        "name": "Nike",
        "slug": "nike",
        "description": "Thương hiệu giày thể thao hàng đầu thế giới"
      },
      {
        "name": "Adidas",
        "slug": "adidas",
        "description": "Thương hiệu thể thao nổi tiếng từ Đức"
      },
      {
        "name": "Puma",
        "slug": "puma",
        "description": "Thương hiệu thể thao với thiết kế độc đáo"
      },
      {
        "name": "Converse",
        "slug": "converse",
        "description": "Thương hiệu giày canvas cổ điển"
      }
    ],
    "users": [
      {
        "email": "admin@gearup.com",
        "username": "admin",
        "full_name": "System Administrator",
        "user_type": "admin"
      },
      {
        "email": "manager@gearup.com",
        "username": "manager",
        "full_name": "Store Manager",
        "user_type": "employee"
      }
    ]
  },
  "constraints": [
    {
      "type": "check",
      "table": "product_reviews",
      "column": "rating",
      "condition": "rating >= 1 AND rating <= 5"
    },
    {
      "type": "check",
      "table": "products",
      "column": "price",
      "condition": "price > 0"
    },
    {
      "type": "check",
      "table": "products",
      "column": "stock_quantity",
      "condition": "stock_quantity >= 0"
    },
    {
      "type": "check",
      "table": "orders",
      "column": "total_amount",
      "condition": "total_amount >= 0"
    }
  ]
}
